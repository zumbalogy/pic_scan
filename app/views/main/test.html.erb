<%= image_tag("cube.jpg", id: 'scream') %>


<canvas id="myCanvas" width="600" height="600">error</canvas>

<script>

var audio_context = new webkitAudioContext();

document.getElementById("scream").onload=function(){
    var can = document.getElementById("myCanvas");
    var ctx = can.getContext("2d");
    var img = document.getElementById("scream");

    ctx.drawImage(img,0,0);

    var imgData = ctx.getImageData(0,0,can.width,can.height);

    var o = audio_context.createOscillator();
    o.frequency.value = 400;
    o.connect(audio_context.destination);
    o.noteOn(0);

    // for (var i=0;i<imgData.data.length;i+=4){
    //     o.frequency.value = imgData.data[i] * 5;
    // };

    function myLoop(i){
        setTimeout(function(){
            o.frequency.value = imgData.data[i] * 5;
            if(--i) myLoop(i);
        }, 50)
    };
    myLoop(imgData.data.length);

    o.noteOff(0);
    ctx.putImageData(imgData,0,0)
}
</script>
<!-- 
        if (i % 8 == 0 || i % 12 == 0) {
            imgData.data[i]   = 255 - imgData.data[i];
            imgData.data[i+1] = 255 - imgData.data[i + 1];
            imgData.data[i+2] = 255 - imgData.data[i + 2];
            imgData.data[i+3] = 255
        } else {
            imgData.data[i]   = imgData.data[i];
            imgData.data[i+1] = imgData.data[i + 1];
            imgData.data[i+2] = imgData.data[i + 2];
            imgData.data[i+3] = 255
        }; -->